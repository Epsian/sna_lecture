---
title: Network Analysis in R
author: "[Jared Joseph](https://jnjoseph.com/)"
date: January 13, 2020
output: rmdformats::readthedown
bibliography: references.bib
---

```{r setup, include=FALSE}
library(knitr)
library(rmdformats)
library(visNetwork)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{r links}
net_url1 = "https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/microsoft/209/male-teacher_1f468-200d-1f3eb.png"
net_url2 = "https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/microsoft/209/female-student_1f469-200d-1f393.png"
net_url3 = "https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/microsoft/209/female-health-worker_1f469-200d-2695-fe0f.png"
net_url4 = "https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/microsoft/209/male-scientist_1f468-200d-1f52c.png"
```

# Overview

*write summary here*

## While you wait

-   Make sure you have installed all the packages you will need: `install.packages(c("statnet", "igraph", "intergraph"))`
-   *DOWNLOAD DATA*
-   Play around with <https://oracleofbacon.org/>

## Learning Objectives

By the end of this class meeting, students should be able to:

-   Understand what a network is.
-   Understand what is and is not relational data.
-   Understand the shortcomings and limitations of network analysis.
-   Analyze the utility of a dataset for network analysis.
-   Evaluate a network dataset and interpret the generated metrics.

## Roadmap

-   What is Social Network Analysis (SNA)
-   Examples of networks in research
-   SNA Data
-   Network (graph) level properties
-   Individual (node) level properties
-   SNA Tools
-   Guided Homework Start/Question Time

# What is Network Analysis

You are all most likely familiar now with tabular data; rows and columns containing information. It looks like this:

| Person                               | Name | Age | Widgits |
|--------------------------------------|:-----|:----|:--------|
| ![](`r net_url1`){width="10%"} | J    | 30  | 1       |
| ![](`r net_url2`){width="10%"} | Y    | 21  | 3       |
| ![](`r net_url3`){width="10%"} | G    | 32  | 4       |
| ![](`r net_url4`){width="10%"} | Z    | 48  | 8       |

While this is a tidy way to store data, it artificially atomizes or separates many of the things we are interested in as researchers, social or otherwise. Network analysis is a tool to work with *relational* data. This is the information about how individuals are connected with each other. For example, the diagram below shows the same data as the table above, with the added benefit of showing how these individuals are connected to each other. Hover over the people to reveal the data about them.

```{r echo=FALSE, out.width='100%'}
nodes = data.frame(id = 1:4, 
                    shape = "image",
                    title = c("<p style='color: black;'>Name: J<br>Age: 30<br>Widgits: 1</p>", "<p style='color: black;'>Name: Y<br>Age: 21<br>Widgits: 3</p>", "<p style='color: black;'>Name: G<br>Age: 32<br>Widgits: 4</p>", "<p style='color: black;'>Name: Z<br>Age: 48<br>Widgits: 8</p>"),
                    image = c(net_url1, net_url2, net_url3, net_url4))

edges = data.frame(from = c(2,4,3,3), to = c(1,2,4,2), label = c("Siblings", "Student", "Friends", "Parent"))

visNetwork(nodes, edges, width = "100%") %>% 
  visNodes(shapeProperties = list(useBorderWithImage = FALSE), size = 50) %>%
  visEdges(length = 200, scaling = list(min = 400)) %>%
  visInteraction(zoomView = FALSE) %>%
  visLayout(randomSeed = 2)
```

Rather than looking only at attributes of specific data points, we are looking at the connections between data. In network analysis, data points are called *nodes* or *vertices*, and the connections between them are called *edges* or *ties*. Vertices can be anything---people, places, word, concepts---they are usually mapped into rows in a data frame. Edges contain any information on how these things connect or are related to each other. These components create a *network* or *graph*, defined as "finite set or sets of actors and the relation or relations defined on them" [@wassermanSocialNetworkAnalysis1994].

## Networks in research - Social Sciences

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/who_shall_survive.png?token=AGC2JV4HE32MDLP2HRWG67DABC6XA")
```

One of the first instances of social network analysis was originally published in 1932 as part of Jacob Moreno's *Who Shall Survive* [-@morenoWhoShallSurvive1953]. This study used the friendship networks of girls within a reform school to show that the ties between them were a stronger predictor of runaways than any attribute of the girls themselves. Since then, networks have been used widely in the social sciences, but only really picked up as the tools to understand SNA became more available.

## Networks in research - Neuroscience

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/neuronet.jpg?token=AGC2JV3IQGC4XW4F4UNPOUDABC6X4")
```

Neuroscientists use networks to study the brain, given their ready application to neurons and pathways. Bassett and Sporns [-@bassettNetworkNeuroscience2017] provide an overview of how to translate neuroscience problems into network ones, and the tools available to study them.

## Networks in research - Chemistry

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/chem_graph.jpg?token=AGC2JV43VML6CWQRQ3X2P6TABC6YQ")
```

Chemistry was quick to see the applications of networks. As early at 1985 papers were published detailing the potential networks provided in terms of understanding and finding new ways to measure and understand the bonds between atoms and molecules [@balabanApplicationsGraphTheory1985].

## Networks in research - The Internet

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/page_rank.jpg?token=AGC2JV2B3KWCXB2B6KGKP3LABC6ZI")
```

The internet is a network! Beyond the various social network sites, servers themselves act as nodes and the information flows between them along edges. Google used this property in the first version of their search engine, which used the network metric of PageRank to determine which sites to show at the top of search results [@pageMethodNodeRanking2001].

## Networks in research - Infrastructure

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/infrastructure_net.jpg?token=AGC2JVZCZ4EMYKSZK5ZOSUDABC62A")
```

[@fanGraphbasedMethodSocial2019]

???

Governments and utilities use social network data to try and find where infrastructure is failing during disasters

## Networks in research - Security

```{r echo=FALSE, out.width= "25%", out.extra='style="float:right; padding:10px"'}
knitr::include_graphics("https://raw.githubusercontent.com/Epsian/sna_lecture/main/resources/terror_net.png?token=AGC2JV5PUJBSL2QWAG2WK73ABC62U")
```

[@krebsMappingNetworksTerrorist2002]

???

Topic we will get to more later: networks are also sometimes used offensively.

Network metrics such as "keyplayer" are used to show what node in a network, when removed, would fragment the network fastest

# Graph Level Properties

Now that we know what networks are and have some example of how they are used, let's get into actually analyzing them. There are a number of metrics we can compute to understand the structure of a network as a whole.

-   Directed or Un-directed
-   Density
-   Centralization

???

## Directed or Un-directed

```{r Directionality, echo=FALSE}
.dir_node = data.frame("id" = 1:10)
.dir_edge = data.frame("from" = c(3, 8, 1, 5, 6, 8, 2, 3, 4, 7, 2, 4, 3, 4, 3), "to" = c(1, 1, 2, 2, 2, 2, 4, 5, 5, 6, 7, 8, 9, 9, 10))
.dir_edge$arrows = sample(c("to", "to;from"), 15, replace = TRUE)

visNetwork(.dir_node, .dir_edge, main = "Directed") %>% visInteraction(zoomView = FALSE)
```

```{r echo=FALSE}
visNetwork(.dir_node, .dir_edge[,1:2], main = "Un-directed") %>% visInteraction(zoomView = FALSE)
```

???

One of the first graph level properties we need to understand is if it is directed or undirected.

Directed - tracks what node is sending something to another node, undirected considers all edges to be mutual. Facebook or twitter.

Which one you may find useful largely depends on what you are interested in, and the data you are using.

## Density

```{r echo=FALSE}
visNetwork(.dir_node, .dir_edge[,1:2], main = "High Density") %>% visInteraction(zoomView = FALSE)
```

```{r echo=FALSE}
visNetwork(.dir_node, .dir_edge[c(1:5,7,10,13,15),1:2], main = "Low Density") %>% visInteraction(zoomView = FALSE)
```

???

Density is a measure of how many edges exist in a network out of the total possible edge count, using $\frac{Actual Edges}{Possible Edges}$.

Networks that are more densely connected are considered to be more cohesive, and robust, in that the removal of any specific edge will not have a great effect of the network as a whole.

It also means that, given the nodes being individuals, each node will have a more direct route to resources that may be present in the network, as they know more individuals who may have the resource they are looking for, or will have a greater chance of knowing someone else who does.

## Centralization

```{r echo=FALSE}
.star_edge = data.frame("from" = c(1,2,3,4,5), "to" = c(6,6,6,6,6))

visNetwork(data.frame("id" = 1:6), .star_edge, main = "Star Network") %>% visInteraction(zoomView = FALSE)
```

```{r echo=FALSE}
.loop_edge = data.frame("from" = c(1,2,3,4,5,6), "to" = c(2,3,4,5,6,1))

visNetwork(data.frame("id" = 1:6), .loop_edge, main = "Loop Network") %>% visInteraction(zoomView = FALSE)
```

???

**Centralization** measures give a sense of the shape of the network, namely how other measures are distributed in a network. Consider the three networks below. The first "Star" network would be considered highly centralized, as one node connects all the others. It would receive a degree centralization score of 1, as 100% of the ties are connected with one node. The loop network would have a score of 0, as every node is equally connected to each other.

```{r Centralization}
## Networks created manually, to assure the propper shape
#ce.star = matrix(data = c(0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0), nrow = 6, ncol = 6)
#ce.star = network(ce.star, matrix.type = "adjacency", directed = FALSE)
#
#ce.line = matrix(data = c(0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0), nrow = 6, ncol = 6)
#ce.line = network(ce.line, matrix.type = "adjacency", directed = FALSE)
#
#ce.circle = matrix(data = c(0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0), nrow = 6, ncol = 6)
#ce.circle = network(ce.circle, matrix.type = "adjacency", directed = FALSE)
#
#par(mfrow=c(1,3))
#plot(ce.star, main = "Star", vertex.cex = 3)
#plot(ce.line, main = "Line", vertex.cex = 3)
#plot(ce.circle, main = "Circle", vertex.cex = 3)
```

------------------------------------------------------------------------

# ADD SOMETHING ABOUT WEIGHTED EDGES

# References
